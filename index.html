<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>玄武</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            // ここでテーマのカスタマイズが可能です
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&family=Yuji+Syuku&display=swap"
      rel="stylesheet"
    />

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#f1f5f9" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="業務支援システム壱號" />
    <link rel="apple-touch-icon" href="apple-icon.png" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />

    <style type="text/tailwindcss">
      /* ▼▼▼ 検索機能用CSS (追加) ▼▼▼ */
      .search-highlight {
        @apply bg-yellow-200 text-slate-900 dark:bg-yellow-600/50 dark:text-white rounded px-0.5 transition-colors duration-200;
      }
      .search-highlight.active {
        @apply bg-orange-500 text-white ring-2 ring-orange-300 dark:ring-orange-700 z-10 relative;
      }

      /* 検索ウィジェットのスタイル */
      #search-widget {
        @apply fixed top-24 right-10 z-[100] bg-white dark:bg-slate-800 shadow-2xl rounded-lg border border-slate-200 dark:border-slate-600 flex items-center p-1 gap-1 w-80 transition-opacity duration-200 opacity-0 pointer-events-none;
      }
      #search-widget.open {
        @apply opacity-100 pointer-events-auto;
      }

      /* ドラッグハンドル */
      .drag-handle {
        @apply cursor-move text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 px-1;
      }
      /* ▼▼▼ このCSSを追記 ▼▼▼ */
      .cell-selected > input {
        @apply ring-2 ring-blue-600 ring-inset z-20 dark:ring-yellow-400;
      }

      /* ▼▼▼ このCSSを追記 ▼▼▼ */
      .cell-selected > input {
        @apply ring-2 ring-blue-600 ring-inset z-20 dark:ring-yellow-400;
      }
      .locked-column {
        @apply !bg-slate-100 dark:!bg-slate-900/50 opacity-75;
      }
      .locked-column > input {
        @apply !bg-transparent;
      }
      /* ▼▼▼ このCSSを追記 ▼▼▼ */
      /* ▼▼▼ このCSSを追記 ▼▼▼ */
      .toast-item {
        @apply bg-green-600 text-white py-3 px-5 rounded-lg shadow-lg transition-all duration-300 transform;
        opacity: 0;
        transform: translateY(20px);
      }
      .toast-item.show {
        opacity: 1;
        transform: translateY(0);
      }
      /* ▼▼▼ このCSSを追記 ▼▼▼ */
      .cell-highlight {
        @apply !bg-yellow-200 dark:!bg-yellow-400/20;
      }
      .font-syuku {
        font-family: "Yuji Syuku", serif;
      }

      body {
        font-family: "Noto Sans JP", "Inter", sans-serif;
        background: linear-gradient(
          to bottom right,
          #e0f2fe,
          #fef9c3
        ) !important;
        background-attachment: fixed;
        padding-top: 80px;
      }
      .dark body {
        background: #0f172a !important;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      .custom-scrollbar::-webkit-scrollbar-track {
        background: #e2e8f0;
      }
      .dark .custom-scrollbar::-webkit-scrollbar-track {
        background: #1e293b;
      }

      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #94a3b8;
        border-radius: 4px;
      }
      .dark .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #475569;
      }

      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }
      .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }

      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      input[type="number"] {
        -moz-appearance: textfield;
      }

      .view {
        display: none;
      }

      .view.active {
        display: block;
      }

      .modal {
        transition: opacity 0.3s ease;
      }

      #loader {
        transition: opacity 0.5s ease-out;
      }

      .input-error {
        border-color: #ef4444 !important;
        --tw-ring-color: #ef4444 !important;
      }

      .btn {
        @apply font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300 flex items-center justify-center gap-2;
      }

      .btn-primary {
        @apply bg-blue-800 hover:bg-blue-900 text-white transform hover:-translate-y-0.5;
      }

      .btn-secondary {
        @apply bg-yellow-500 hover:bg-yellow-600 text-slate-900 transform hover:-translate-y-0.5;
      }

      .btn-danger {
        @apply bg-red-600 hover:bg-red-700 text-white transform hover:-translate-y-0.5;
      }

      .btn-neutral {
        @apply bg-slate-200 hover:bg-slate-300 text-slate-800 transform hover:-translate-y-0.5 dark:bg-slate-600 dark:hover:bg-slate-500 dark:text-slate-200;
      }

      .nav-tab.active {
        @apply bg-blue-800 text-white dark:text-white;
      }
      .dark .nav-tab.active {
        @apply bg-blue-600;
      }

      /* ▼▼▼ 追加：カラーパレット用スタイル ▼▼▼ */
      .color-swatch {
        @apply w-8 h-8 rounded-md cursor-pointer border border-slate-300 hover:scale-110 transition-transform shadow-sm;
      }
      .color-swatch.selected {
        @apply ring-2 ring-offset-2 ring-blue-500 border-transparent;
      }
      /* ▲▲▲ 追加ここまで ▲▲▲ */

      @keyframes wrench-turn {
        0% {
          transform: rotate(-15deg);
        }

        20% {
          transform: rotate(45deg);
        }

        80% {
          transform: rotate(45deg);
        }

        100% {
          transform: rotate(-15deg);
        }
      }

      .animate-wrench {
        animation: wrench-turn 1.5s ease-in-out infinite !important;
        transform-origin: center;
      }

      .table-header-color {
        @apply bg-slate-200 text-slate-700 dark:bg-slate-700 dark:text-slate-200;
      }
      .table-row-color {
        @apply hover:bg-slate-50 dark:hover:bg-slate-700/50;
      }
      .table-sticky-color {
        @apply bg-white dark:bg-slate-800;
      }
      .table-sticky-header-color {
        @apply bg-blue-200 dark:bg-slate-700 border-blue-300 dark:border-slate-600;
      }
      .table-footer-color {
        /* ▼▼▼ 修正：黄色からオレンジに変更 ▼▼▼ */
        @apply bg-orange-300 text-orange-900 dark:bg-orange-900/50 dark:text-orange-100;
      }
      .bolt-option-btn {
        @apply text-sm p-2 hover:bg-yellow-200 border border-blue-200 rounded-md transition-transform duration-150 hover:scale-105 dark:border-slate-600 dark:hover:bg-yellow-600;
      }
      .joint-option-btn {
        @apply text-sm p-2 hover:bg-yellow-200 border border-blue-200 rounded-md transition-transform duration-150 hover:scale-105 dark:border-slate-600 dark:hover:bg-yellow-600;
      }
    </style>
  </head>

  <body class="text-slate-800 dark:text-slate-200 antialiased">
    <div
      id="loader"
      class="fixed inset-0 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50"
    >
      <div class="text-center">
        <div class="relative h-16 w-16 mx-auto mb-4">
          <svg
            class="absolute top-0 left-0 h-16 w-16 text-slate-600 dark:text-slate-400 animate-pulse"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M21.707 10.293l-3-3A.996.996 0 0018 7H6a.996.996 0 00-.707.293l-3 3a.999.999 0 000 1.414l3 3A.996.996 0 006 17h12a.996.996 0 00.707-.293l3-3a.999.999 0 000-1.414zM18 15H6l-2-2 2-2h12l2 2-2 2z"
            ></path>
          </svg>
          <svg
            class="absolute top-0 left-0 h-16 w-16 text-yellow-500 animate-wrench"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
            />
          </svg>
        </div>
        <p class="text-slate-800 dark:text-slate-200 font-semibold">
          データベースに接続中...
        </p>
      </div>
    </div>

    <nav
      id="fixed-nav"
      class="fixed top-0 left-0 w-full bg-slate-100 dark:bg-slate-800 shadow-md z-40 p-2 transition-colors duration-300"
    >
      <div class="container mx-auto flex justify-between items-center">
        <div id="nav-list-context">
          <h1
            class="text-xl font-syuku font-bold text-slate-900 dark:text-slate-100"
          >
            業務支援システム壱號
          </h1>
        </div>

        <div id="nav-detail-context" class="flex-1 min-w-0 hidden">
          <h2
            id="nav-project-title"
            class="text-lg font-bold text-slate-900 dark:text-slate-100 truncate px-2"
          ></h2>
        </div>

        <div class="hidden md:flex items-center gap-4">
          <div id="nav-detail-buttons" class="hidden items-center gap-2">
            <button id="nav-back-to-list-btn" class="btn btn-neutral text-sm">
              物件一覧に戻る
            </button>
            <div class="flex items-center gap-1">
              <button
                id="undo-btn"
                class="p-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed"
                title="元に戻す"
              >
                <svg
                  class="w-5 h-5 text-slate-700 dark:text-slate-300"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"
                  />
                </svg>
              </button>
              <button
                id="redo-btn"
                class="p-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed"
                title="やり直し"
              >
                <svg
                  class="w-5 h-5 text-slate-700 dark:text-slate-300"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 15l6-6m0 0l-6-6m6 6H9a6 6 0 000 12h3"
                  />
                </svg>
              </button>
            </div>

            <div class="flex bg-slate-300 dark:bg-slate-700 rounded-lg p-1">
              <button
                id="nav-tab-joints"
                data-tab="joints"
                class="nav-tab px-4 py-1.5 text-sm font-semibold rounded-md transition-colors text-slate-700 dark:text-slate-200"
              >
                継手と部材
              </button>
              <button
                id="nav-tab-tally"
                data-tab="tally"
                class="nav-tab px-4 py-1.5 text-sm font-semibold rounded-md transition-colors text-slate-700 dark:text-slate-200"
              >
                入力と集計
              </button>
            </div>
          </div>

          <div class="flex items-center gap-2 ml-4">
            <!-- ▼▼▼ 追加：ボルトサイズ設定ボタン ▼▼▼ -->
            <button
              id="nav-btn-bolt-settings"
              class="text-slate-500 hover:text-blue-600 dark:text-slate-400 dark:hover:text-blue-400 transition-colors hidden"
              title="ボルトサイズ設定"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
                ></path>
              </svg>
            </button>
            <!-- ▲▲▲ 追加ここまで ▲▲▲ -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-slate-500"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <label
              for="dark-mode-toggle"
              class="relative inline-flex items-center cursor-pointer"
            >
              <input
                type="checkbox"
                value=""
                id="dark-mode-toggle"
                class="sr-only peer"
              />
              <div
                class="w-11 h-6 bg-slate-300 peer-focus:outline-none rounded-full peer dark:bg-slate-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-800"
              ></div>
            </label>
          </div>
        </div>

        <div class="md:hidden flex items-center gap-2">
          <label
            for="mobile-dark-mode-toggle"
            class="relative inline-flex items-center cursor-pointer"
          >
            <input
              type="checkbox"
              value=""
              id="mobile-dark-mode-toggle"
              class="sr-only peer"
            />
            <div
              class="w-11 h-6 bg-slate-300 peer-focus:outline-none rounded-full peer dark:bg-slate-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-800"
            ></div>
          </label>
          <button
            id="hamburger-btn"
            class="text-slate-800 dark:text-slate-200 focus:outline-none"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"
              />
            </svg>
          </button>
        </div>
      </div>
      <div id="mobile-menu" class="md:hidden hidden mt-2 space-y-2 px-2 pb-3">
        <div id="mobile-nav-detail-buttons">
          <button
            id="mobile-nav-tab-joints"
            data-tab="joints"
            class="nav-tab block w-full text-left bg-slate-200 dark:bg-slate-700 dark:text-slate-200 px-4 py-2 text-sm font-semibold rounded-md transition-colors"
          >
            継手と部材
          </button>
          <button
            id="mobile-nav-tab-tally"
            data-tab="tally"
            class="nav-tab block w-full text-left bg-slate-200 dark:bg-slate-700 dark:text-slate-200 px-4 py-2 text-sm font-semibold rounded-md transition-colors"
          >
            入力と集計
          </button>
          <div class="flex items-center gap-2 pt-2">
            <button id="mobile-undo-btn" class="flex-1 btn btn-neutral text-sm">
              元に戻す
            </button>
            <button id="mobile-redo-btn" class="flex-1 btn btn-neutral text-sm">
              やり直し
            </button>
          </div>
          <button
            id="mobile-nav-back-to-list-btn"
            class="mt-2 block w-full text-left btn btn-neutral text-sm"
          >
            物件一覧に戻る
          </button>
        </div>
      </div>
    </nav>

    <div class="p-4 md:p-6 lg:p-8">
      <header id="main-header" class="hidden">
        <h1 class="text-4xl md:text-5xl font-syuku font-bold text-slate-900">
          業務支援システム壱號
        </h1>
        <p class="text-slate-600 mt-2">ボルト集計と発注</p>
        <p class="text-sm text-slate-500 mt-1">Ver. 1.2.1</p>
      </header>

      <main id="project-list-view" class="view active space-y-8">
        <section class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl">
          <h2
            class="text-2xl font-bold mb-4 border-b-2 border-yellow-400 pb-2 text-slate-900 dark:text-slate-100"
          >
            物件一覧
          </h2>
          <div
            class="bg-slate-50 dark:bg-slate-800 p-4 mb-6 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700"
          >
            <h3
              class="text-lg font-semibold mb-3 text-slate-900 dark:text-slate-100"
            >
              新規工事登録
            </h3>
            <input
              type="text"
              id="project-name"
              class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 mb-4 dark:placeholder-slate-400"
              placeholder="工事名 (例: 森下産業_屋上目隠し"
            />
            <input
              type="text"
              id="property-name"
              class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 mb-4 dark:placeholder-slate-400"
              placeholder="物件名（グループ化用、任意）"
            />
            <div class="flex items-center gap-2 mb-4">
              <input
                type="checkbox"
                id="advanced-settings-toggle"
                class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
              />
              <label
                for="advanced-settings-toggle"
                class="text-sm font-medium text-slate-700 dark:text-slate-300"
                >細かい設定</label
              >
            </div>
            <div id="simple-project-settings">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <input
                  type="number"
                  id="project-floors"
                  min="2"
                  class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                  placeholder="階数 (R, PH階を除く)"
                />
                <input
                  type="number"
                  id="project-sections"
                  min="1"
                  class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                  placeholder="工区数"
                />
                <div
                  class="sm:col-span-2 flex items-center gap-4 bg-slate-100 dark:bg-slate-700/50 p-3 rounded-lg"
                >
                  <label
                    for="project-has-ph"
                    class="font-medium text-slate-700 dark:text-slate-300"
                    >PH階 (塔屋) はありますか？</label
                  >
                  <input
                    type="checkbox"
                    id="project-has-ph"
                    class="h-5 w-5 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                  />
                </div>
              </div>
            </div>
            <div id="advanced-project-settings" class="hidden space-y-4">
              <div>
                <label
                  for="add-custom-levels-count"
                  class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                  >階層数</label
                >
                <div
                  class="flex items-center border border-slate-300 dark:border-slate-600 rounded-lg"
                >
                  <button
                    type="button"
                    id="add-decrement-levels-btn"
                    class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-l-lg transition-colors font-bold text-lg"
                  >
                    -
                  </button>
                  <input
                    type="text"
                    id="add-custom-levels-count"
                    readonly
                    class="w-full text-center border-l border-r dark:border-slate-600 bg-white dark:bg-slate-700 p-3 text-slate-900 dark:text-slate-100 focus:outline-none"
                    value="1"
                  />
                  <button
                    type="button"
                    id="add-increment-levels-btn"
                    class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-r-lg transition-colors font-bold text-lg"
                  >
                    +
                  </button>
                </div>
                <div
                  id="custom-levels-container"
                  class="grid grid-cols-2 sm:grid-cols-3 gap-2 mt-2"
                ></div>
              </div>
              <div>
                <label
                  for="add-custom-areas-count"
                  class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                  >エリア数</label
                >
                <div
                  class="flex items-center border border-slate-300 dark:border-slate-600 rounded-lg"
                >
                  <button
                    type="button"
                    id="add-decrement-areas-btn"
                    class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-l-lg transition-colors font-bold text-lg"
                  >
                    -
                  </button>
                  <input
                    type="text"
                    id="add-custom-areas-count"
                    readonly
                    class="w-full text-center border-l border-r dark:border-slate-600 bg-white dark:bg-slate-700 p-3 text-slate-900 dark:text-slate-100 focus:outline-none"
                    value="1"
                  />
                  <button
                    type="button"
                    id="add-increment-areas-btn"
                    class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-r-lg transition-colors font-bold text-lg"
                  >
                    +
                  </button>
                </div>
                <div
                  id="custom-areas-container"
                  class="grid grid-cols-2 sm:grid-cols-3 gap-2 mt-2"
                ></div>
              </div>
            </div>
            <button id="add-project-btn" class="mt-4 w-full btn btn-primary">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              新しい工事を登録
            </button>
          </div>
          <div id="projects-container" class="space-y-4 mb-6"></div>
        </section>
      </main>

      <main id="project-detail-view" class="view space-y-8">
        <div id="joints-section">
          <section
            id="settings-card"
            class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl"
          >
            <div
              class="flex flex-col sm:flex-row justify-between sm:items-center mb-6 border-b-2 border-yellow-400 pb-3 gap-4"
            >
              <div class="flex items-center gap-4">
                <h2
                  class="text-2xl font-bold text-slate-900 dark:text-slate-100"
                >
                  継手と部材の登録
                </h2>
                <div class="flex bg-slate-200 dark:bg-slate-700 rounded-lg p-1">
                  <button
                    id="switch-view-joints"
                    class="px-4 py-1.5 text-sm font-bold rounded-md shadow-sm bg-white dark:bg-slate-600 text-blue-800 dark:text-blue-100 transition-all"
                  >
                    継手登録
                  </button>
                  <button
                    id="switch-view-members"
                    class="px-4 py-1.5 text-sm font-bold rounded-md text-slate-600 dark:text-slate-400 hover:bg-slate-300 dark:hover:bg-slate-600 transition-all"
                  >
                    部材登録
                  </button>
                </div>
              </div>

              <div class="flex gap-2">
                <button
                  id="open-temp-bolt-mapping-btn"
                  class="btn btn-secondary text-sm"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"
                    />
                    <path
                      fill-rule="evenodd"
                      d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  仮ボルト設定
                </button>
              </div>
            </div>

            <div id="view-joints-area" class="transition-opacity duration-300">
              <div class="flex flex-col md:flex-row gap-8">
                <div class="hidden md:block w-full md:w-1/3">
                  <h3
                    class="text-xl font-semibold mb-3 text-slate-900 dark:text-slate-100"
                  >
                    継手登録フォーム
                  </h3>
                  <div
                    class="space-y-4 bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700"
                  >
                    <div>
                      <label
                        for="joint-type"
                        class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                        >鉄骨の種類</label
                      >
                      <select
                        id="joint-type"
                        class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500"
                      >
                        <option value="girder">大梁</option>
                        <option value="beam">小梁</option>
                        <option value="column">本柱</option>
                        <option value="stud">間柱</option>
                        <option value="wall_girt">胴縁</option>
                        <option value="roof_purlin">母屋</option>
                        <option value="other">その他</option>
                      </select>
                    </div>

                    <p
                      class="text-xs text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-700/50 p-2 rounded-md border border-slate-200 dark:border-slate-600"
                    >
                      ※仮ボルト本数は、上下フランジ片側、ウェブ片側の本数を表しています。<br />
                      ※鋼接合はボルト総数を入力してください。(2面せん断及びシングルSPLも)
                    </p>

                    <div id="temp-bolt-setting-group">
                      <label
                        for="temp-bolt-setting"
                        class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                        >仮ボルト設定</label
                      >
                      <select
                        id="temp-bolt-setting"
                        class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500"
                      >
                        <option value="calculated">規程本数</option>
                        <option value="none">使用しない</option>
                      </select>
                    </div>

                    <div id="shop-temp-bolt-group">
                      <div id="shop-temp-bolt-group-single" class="hidden">
                        <div class="grid grid-cols-2 gap-4">
                          <div class="relative">
                            <label
                              for="shop-temp-bolt-size"
                              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                              >手動指定：仮ボルトサイズ</label
                            >
                            <input
                              type="text"
                              id="shop-temp-bolt-size"
                              readonly
                              class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 pr-10 cursor-pointer modal-trigger-input"
                              placeholder="サイズ選択"
                            />
                            <button
                              data-target="shop-temp-bolt-size"
                              class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-blue-800 dark:hover:text-blue-400 mt-7"
                            >
                              ▼
                            </button>
                          </div>
                          <div>
                            <label
                              for="shop-temp-bolt-count"
                              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                              >手動指定：仮ボルト本数</label
                            >
                            <input
                              type="number"
                              id="shop-temp-bolt-count"
                              min="1"
                              class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                              placeholder="1以上の数値を入力"
                            />
                          </div>
                        </div>
                      </div>
                      <div
                        id="shop-temp-bolt-group-dual"
                        class="hidden space-y-2"
                      >
                        <div class="grid grid-cols-2 gap-4">
                          <div class="relative">
                            <label
                              for="shop-temp-bolt-size-f"
                              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                              >工場用F仮ボルトサイズ</label
                            >
                            <input
                              type="text"
                              id="shop-temp-bolt-size-f"
                              readonly
                              class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 pr-10 cursor-pointer modal-trigger-input"
                              placeholder="サイズ選択"
                            />
                            <button
                              data-target="shop-temp-bolt-size-f"
                              class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-blue-800 dark:hover:text-blue-400 mt-7"
                            >
                              ▼
                            </button>
                          </div>
                          <div>
                            <label
                              for="shop-temp-bolt-count-f"
                              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                              >工場用F仮ボルト本数</label
                            >
                            <input
                              type="number"
                              id="shop-temp-bolt-count-f"
                              min="1"
                              class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                              placeholder="本数"
                            />
                          </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                          <div class="relative">
                            <label
                              for="shop-temp-bolt-size-w"
                              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                              >工場用W仮ボルトサイズ</label
                            >
                            <input
                              type="text"
                              id="shop-temp-bolt-size-w"
                              readonly
                              class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 pr-10 cursor-pointer modal-trigger-input"
                              placeholder="サイズ選択"
                            />
                            <button
                              data-target="shop-temp-bolt-size-w"
                              class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-blue-800 dark:hover:text-blue-400 mt-7"
                            >
                              ▼
                            </button>
                          </div>
                          <div>
                            <label
                              for="shop-temp-bolt-count-w"
                              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                              >工場用W仮ボルト本数</label
                            >
                            <input
                              type="number"
                              id="shop-temp-bolt-count-w"
                              min="1"
                              class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                              placeholder="本数"
                            />
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="flex flex-wrap items-center gap-4">
                      <div
                        id="pin-joint-group"
                        class="hidden flex items-center gap-4"
                      >
                        <label class="flex items-center gap-2 cursor-pointer">
                          <input
                            type="checkbox"
                            id="is-pin-joint"
                            class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                          />
                          <span
                            class="text-sm font-medium text-slate-700 dark:text-slate-300"
                            >ピン取り</span
                          >
                        </label>
                        <div id="double-shear-group" class="hidden">
                          <label class="flex items-center gap-2 cursor-pointer">
                            <input
                              type="checkbox"
                              id="is-double-shear"
                              class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                            />
                            <span
                              class="text-sm font-medium text-slate-700 dark:text-slate-300"
                              >2面せん断,シングルSPL</span
                            >
                          </label>
                        </div>
                        <div
                          id="complex-spl-group"
                          class="hidden space-y-3 pt-3 border-t border-slate-300 dark:border-slate-600"
                        >
                          <label class="flex items-center gap-2 cursor-pointer">
                            <input
                              type="checkbox"
                              id="is-complex-spl"
                              class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                            />
                            <span
                              class="text-sm font-medium text-slate-700 dark:text-slate-300"
                              >複合型SPL</span
                            >
                          </label>
                          <div id="complex-spl-count-group" class="hidden">
                            <label
                              for="complex-spl-count"
                              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                              >スプライス種類数</label
                            >
                            <div
                              class="flex items-center border border-slate-300 dark:border-slate-600 rounded-lg"
                            >
                              <button
                                type="button"
                                id="decrement-complex-spl-btn"
                                class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-l-lg transition-colors font-bold text-lg"
                              >
                                -
                              </button>
                              <input
                                type="text"
                                id="complex-spl-count"
                                readonly
                                class="w-full text-center border-l border-r dark:border-slate-600 bg-white dark:bg-slate-700 p-3 text-slate-900 dark:text-slate-100 focus:outline-none"
                                value="2"
                              />
                              <button
                                type="button"
                                id="increment-complex-spl-btn"
                                class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-r-lg transition-colors font-bold text-lg"
                              >
                                +
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div id="count-as-member-group">
                        <label class="flex items-center gap-2 cursor-pointer">
                          <input
                            type="checkbox"
                            id="count-as-member"
                            class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                          />
                          <span
                            class="text-sm font-medium text-slate-700 dark:text-slate-300"
                            >部材としてカウント</span
                          >
                        </label>
                      </div>
                      <div
                        id="shop-spl-group"
                        class="hidden pt-2 flex items-center space-x-4"
                      >
                        <label class="flex items-center gap-2 cursor-pointer">
                          <input
                            type="checkbox"
                            id="has-shop-spl"
                            class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                          />
                          <span
                            class="text-sm font-medium text-slate-700 dark:text-slate-300"
                            >工場でSPLセットあり</span
                          >
                        </label>
                        <div id="bolt-correction-group">
                          <label class="flex items-center gap-2 cursor-pointer">
                            <input
                              type="checkbox"
                              id="has-bolt-correction"
                              class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                            />
                            <span
                              class="text-sm font-medium text-slate-700 dark:text-slate-300"
                              >増しボルト補正あり</span
                            >
                          </label>
                        </div>
                      </div>
                      <div
                        id="bundle-column-group"
                        class="flex items-center mt-2"
                      >
                        <input
                          type="checkbox"
                          id="is-bundled-with-column"
                          class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                        />
                        <label
                          for="is-bundled-with-column"
                          class="ml-2 block text-sm text-gray-900 dark:text-gray-300"
                        >
                          本柱と同梱
                          <span class="text-xs text-gray-500"
                            >※本ボルト明細で「本柱」に合算</span
                          >
                        </label>
                      </div>
                    </div>

                    <input
                      type="text"
                      id="joint-name"
                      class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                      placeholder="継手名 (例: G1-C1)"
                    />

                    <div class="mt-2">
                      <div class="flex items-center gap-2">
                        <input
                          type="checkbox"
                          id="joint-color-toggle"
                          class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500 cursor-pointer"
                        />
                        <label
                          for="joint-color-toggle"
                          class="text-sm font-medium text-slate-700 dark:text-slate-300 select-none cursor-pointer"
                          >色を設定する</label
                        >
                      </div>
                      <div
                        id="joint-color-section"
                        class="hidden mt-2 bg-slate-100 dark:bg-slate-700/50 p-3 rounded-lg border border-slate-200 dark:border-slate-600"
                      >
                        <div
                          id="static-color-palette-container"
                          class="flex flex-wrap gap-2 mb-3"
                        ></div>
                        <div
                          class="flex items-center justify-between pt-2 border-t border-slate-200 dark:border-slate-600"
                        >
                          <label
                            class="flex items-center gap-2 cursor-pointer text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400"
                          >
                            <div class="relative">
                              <span
                                class="block w-8 h-8 rounded-full bg-gradient-to-br from-red-500 via-green-500 to-blue-500 border border-slate-300 shadow-sm"
                              ></span>
                              <input
                                type="color"
                                id="joint-color-input"
                                class="absolute inset-0 opacity-0 cursor-pointer w-full h-full"
                                value="#ffffff"
                              />
                            </div>
                            <span>その他の色...</span>
                          </label>
                          <button
                            type="button"
                            id="static-clear-joint-color-btn"
                            class="text-xs text-slate-500 hover:text-red-500 dark:text-slate-400 dark:hover:text-red-400 border border-slate-300 dark:border-slate-600 px-2 py-1 rounded hover:bg-white dark:hover:bg-slate-800 transition-colors bg-white dark:bg-slate-800"
                          >
                            選択解除
                          </button>
                        </div>
                      </div>
                    </div>

                    <div id="flange-input-group">
                      <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                          <input
                            type="text"
                            id="flange-size"
                            readonly
                            class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 pr-10 cursor-pointer modal-trigger-input dark:placeholder-slate-400"
                            placeholder="フランジ サイズ"
                          />
                          <button
                            data-target="flange-size"
                            class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-blue-800 dark:hover:text-blue-400"
                          >
                            ▼
                          </button>
                        </div>
                        <input
                          type="number"
                          id="flange-count"
                          min="0"
                          class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                          placeholder="本数"
                        />
                      </div>
                    </div>

                    <div id="web-input-group">
                      <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                          <input
                            type="text"
                            id="web-size"
                            readonly
                            class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 pr-10 cursor-pointer modal-trigger-input dark:placeholder-slate-400"
                            placeholder="ウェブ サイズ"
                          />
                          <button
                            data-target="web-size"
                            class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-blue-800 dark:hover:text-blue-400"
                          >
                            ▼
                          </button>
                        </div>
                        <input
                          type="number"
                          id="web-count"
                          min="0"
                          class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                          placeholder="本数"
                        />
                      </div>
                    </div>
                    <div id="web-input-group-2" class="hidden">
                      <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                          <input
                            type="text"
                            id="web-size-2"
                            readonly
                            class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 pr-10 cursor-pointer modal-trigger-input dark:placeholder-slate-400"
                            placeholder="ウェブ サイズ 2"
                          />
                          <button
                            data-target="web-size-2"
                            class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-blue-800 dark:hover:text-blue-400"
                          >
                            ▼
                          </button>
                        </div>
                        <input
                          type="number"
                          id="web-count-2"
                          min="0"
                          class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                          placeholder="本数"
                        />
                      </div>
                    </div>
                    <div id="web-input-group-3" class="hidden">
                      <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                          <input
                            type="text"
                            id="web-size-3"
                            readonly
                            class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 pr-10 cursor-pointer modal-trigger-input dark:placeholder-slate-400"
                            placeholder="ウェブ サイズ 3"
                          />
                          <button
                            data-target="web-size-3"
                            class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-blue-800 dark:hover:text-blue-400"
                          >
                            ▼
                          </button>
                        </div>
                        <input
                          type="number"
                          id="web-count-3"
                          min="0"
                          class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                          placeholder="本数"
                        />
                      </div>
                    </div>
                    <div id="web-input-group-4" class="hidden">
                      <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                          <input
                            type="text"
                            id="web-size-4"
                            readonly
                            class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 pr-10 cursor-pointer modal-trigger-input dark:placeholder-slate-400"
                            placeholder="ウェブ サイズ 4"
                          />
                          <button
                            data-target="web-size-4"
                            class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-blue-800 dark:hover:text-blue-400"
                          >
                            ▼
                          </button>
                        </div>
                        <input
                          type="number"
                          id="web-count-4"
                          min="0"
                          class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                          placeholder="本数"
                        />
                      </div>
                    </div>

                    <button id="add-joint-btn" class="w-full btn btn-primary">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                      </svg>
                      継手を追加
                    </button>
                  </div>
                </div>

                <div
                  id="joint-lists-container"
                  class="w-full md:w-2/3 space-y-6"
                ></div>
              </div>
            </div>

            <div
              id="view-members-area"
              class="hidden transition-opacity duration-300"
            >
              <div class="flex flex-col md:flex-row gap-8">
                <div class="hidden md:block w-full md:w-1/3">
                  <h3
                    class="text-xl font-semibold mb-3 text-slate-900 dark:text-slate-100"
                  >
                    部材登録フォーム
                  </h3>
                  <div
                    class="space-y-4 bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700"
                  >
                    <input
                      type="text"
                      id="member-name"
                      class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 focus:ring-yellow-500 focus:border-yellow-500 dark:placeholder-slate-400"
                      placeholder="部材名 (例: GJ440)"
                    />
                    <div>
                      <label
                        class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                        >使用する階層 (選択なし＝全階層)</label
                      >
                      <div
                        id="add-member-levels-container"
                        class="grid grid-cols-3 gap-2 max-h-32 overflow-y-auto custom-scrollbar border border-slate-300 dark:border-slate-600 rounded-lg p-2 bg-slate-50 dark:bg-slate-700/50"
                      ></div>
                    </div>
                    <div>
                      <label
                        for="member-joint-select-input"
                        class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                        >使用する継手</label
                      >
                      <div class="relative">
                        <input
                          type="text"
                          id="member-joint-select-input"
                          readonly
                          class="w-full bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-slate-100 rounded-lg p-3 pr-10 cursor-pointer dark:placeholder-slate-400"
                          placeholder="継手を選択..."
                        />
                        <input type="hidden" id="member-joint-select-id" />
                        <button
                          id="open-joint-selector-btn"
                          class="absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 dark:text-slate-400 hover:text-blue-800 dark:hover:text-blue-400"
                        >
                          ▼
                        </button>
                      </div>
                    </div>
                    <button id="add-member-btn" class="w-full btn btn-primary">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                      </svg>
                      部材を追加
                    </button>
                  </div>
                </div>
                <div class="w-full md:w-2/3">
                  <div
                    id="member-list-tabs"
                    class="flex flex-wrap gap-2 mb-4"
                  ></div>
                  <div id="member-lists-container" class="space-y-6"></div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <div id="tally-section" class="hidden mt-8">
          <section
            id="tally-card"
            class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl mt-8"
          >
            <div
              class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 border-b-2 border-yellow-400 pb-2 gap-3"
            >
              <h2 class="text-2xl font-bold text-slate-900 dark:text-slate-100">
                箇所数入力 (部材ごと)
              </h2>
              <button
                id="copy-tally-btn"
                class="btn btn-neutral text-sm self-end"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-4 h-4 flex-shrink-0"
                  viewBox="0 0 16 16"
                  fill="currentColor"
                >
                  <path
                    d="M14 1.5a.5.5 0 0 1 .5.5v11.5a.5.5 0 0 1-1 0V2a1 1 0 0 0-1-1H2.5a.5.5 0 0 1 0-1H13a2 2 0 0 1 2 2zM3.5 4A1.5 1.5 0 0 0 2 5.5v9A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 12.5 4h-9zM3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-9z"
                  />
                </svg>
                クリップボードにコピー
              </button>
            </div>
            <div
              id="tally-floor-tabs"
              class="flex flex-wrap gap-2 mb-4 px-2"
            ></div>
            <div
              id="tally-sheet-container"
              class="overflow-x-auto custom-scrollbar"
            ></div>
          </section>
          <section
            id="results-card"
            class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl hidden mt-8 overflow-hidden"
          >
            <div id="results-card-content"></div>
          </section>
        </div>
      </main>
    </div>

    <div
      id="edit-joint-modal"
      class="modal modeless fixed top-24 left-1/2 transform -translate-x-1/2 bg-white dark:bg-slate-800 rounded-xl shadow-2xl shadow-black/50 w-full max-w-md flex flex-col max-h-[80vh] border border-slate-200 dark:border-slate-600 z-50 hidden opacity-0"
    >
      <div
        class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700 cursor-move select-none"
      >
        <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">
          継手の編集
        </h3>
        <button
          id="close-edit-modal-btn"
          class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
        >
          &times;
        </button>
      </div>

      <div class="p-6 space-y-4 overflow-y-auto custom-scrollbar flex-1">
        <input type="hidden" id="edit-joint-id" />
        <div>
          <label
            for="edit-joint-type"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >鉄骨の種類</label
          >
          <select
            id="edit-joint-type"
            class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
          >
            <option value="girder">大梁</option>
            <option value="beam">小梁</option>
            <option value="column">本柱</option>
            <option value="stud">間柱</option>
            <option value="wall_girt">胴縁</option>
            <option value="roof_purlin">母屋</option>
            <option value="other">その他</option>
          </select>
        </div>

        <div id="edit-temp-bolt-setting-group">
          <label
            for="edit-temp-bolt-setting"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >仮ボルト設定</label
          >
          <select
            id="edit-temp-bolt-setting"
            class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
          >
            <option value="calculated">規程本数</option>
            <option value="none">使用しない</option>
          </select>
        </div>

        <div id="edit-shop-temp-bolt-group">
          <div id="edit-shop-temp-bolt-group-single" class="hidden">
            <div class="grid grid-cols-2 gap-4">
              <div class="relative">
                <label
                  for="edit-shop-temp-bolt-size"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >手動指定：仮ボルトサイズ</label
                >
                <input
                  type="text"
                  id="edit-shop-temp-bolt-size"
                  readonly
                  class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 pr-10 cursor-pointer modal-trigger-input"
                  placeholder="サイズ選択"
                />
                <button
                  data-target="edit-shop-temp-bolt-size"
                  class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:text-blue-800 dark:hover:text-blue-400 mt-7"
                >
                  ▼
                </button>
              </div>
              <div>
                <label
                  for="edit-shop-temp-bolt-count"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >手動指定：仮ボルト本数</label
                >
                <input
                  type="number"
                  id="edit-shop-temp-bolt-count"
                  min="1"
                  class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
                />
              </div>
            </div>
          </div>
          <div id="edit-shop-temp-bolt-group-dual" class="hidden space-y-2">
            <div class="grid grid-cols-2 gap-4">
              <div class="relative">
                <label
                  for="edit-shop-temp-bolt-size-f"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >工場用F仮ボルトサイズ</label
                >
                <input
                  type="text"
                  id="edit-shop-temp-bolt-size-f"
                  readonly
                  class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 pr-10 cursor-pointer modal-trigger-input"
                  placeholder="サイズ選択"
                />
                <button
                  data-target="edit-shop-temp-bolt-size-f"
                  class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:text-blue-800 dark:hover:text-blue-400 mt-7"
                >
                  ▼
                </button>
              </div>
              <div>
                <label
                  for="edit-shop-temp-bolt-count-f"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >工場用F仮ボルト本数</label
                >
                <input
                  type="number"
                  id="edit-shop-temp-bolt-count-f"
                  min="1"
                  class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
                />
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div class="relative">
                <label
                  for="edit-shop-temp-bolt-size-w"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >工場用W仮ボルトサイズ</label
                >
                <input
                  type="text"
                  id="edit-shop-temp-bolt-size-w"
                  readonly
                  class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 pr-10 cursor-pointer modal-trigger-input"
                  placeholder="サイズ選択"
                />
                <button
                  data-target="edit-shop-temp-bolt-size-w"
                  class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:text-blue-800 dark:hover:text-blue-400 mt-7"
                >
                  ▼
                </button>
              </div>
              <div>
                <label
                  for="edit-shop-temp-bolt-count-w"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >工場用W仮ボルト本数</label
                >
                <input
                  type="number"
                  id="edit-shop-temp-bolt-count-w"
                  min="1"
                  class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="flex flex-wrap items-center gap-4">
          <div id="edit-pin-joint-group" class="hidden flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                id="edit-is-pin-joint"
                class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
              />
              <span
                class="text-sm font-medium text-slate-700 dark:text-slate-300"
                >ピン取り</span
              >
            </label>
            <div id="edit-double-shear-group" class="hidden">
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  id="edit-is-double-shear"
                  class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                />
                <span
                  class="text-sm font-medium text-slate-700 dark:text-slate-300"
                  >2面せん断,シングルSPL</span
                >
              </label>
            </div>
            <!-- <div id="edit-bundle-column-group" class="flex items-center mt-2">
                        <input type="checkbox" id="edit-is-bundled-with-column"
                            class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                        <label for="edit-is-bundled-with-column"
                            class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                            本柱と同梱 <span class="text-xs text-gray-500">※本ボルト明細で「本柱」に合算されます</span>
                        </label>
                    </div> -->
            <div
              id="edit-complex-spl-group"
              class="hidden space-y-3 pt-3 border-t border-gray-300 dark:border-slate-600"
            >
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  id="edit-is-complex-spl"
                  class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                />
                <span
                  class="text-sm font-medium text-slate-700 dark:text-slate-300"
                  >複合型SPL</span
                >
              </label>
              <div id="edit-complex-spl-count-group" class="hidden">
                <label
                  for="edit-complex-spl-count"
                  class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                  >スプライス種類数</label
                >
                <div
                  class="flex items-center border border-gray-400 dark:border-slate-600 rounded-md"
                >
                  <button
                    type="button"
                    id="edit-decrement-complex-spl-btn"
                    class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-l-md transition-colors font-bold text-lg"
                  >
                    -
                  </button>
                  <input
                    type="text"
                    id="edit-complex-spl-count"
                    readonly
                    class="w-full text-center border-l border-r dark:border-slate-600 bg-white dark:bg-slate-700 p-3 text-gray-900 dark:text-slate-100 focus:outline-none"
                    value="2"
                  />
                  <button
                    type="button"
                    id="edit-increment-complex-spl-btn"
                    class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-r-md transition-colors font-bold text-lg"
                  >
                    +
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div id="edit-count-as-member-group">
            <label class="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                id="edit-count-as-member"
                class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
              />
              <span
                class="text-sm font-medium text-slate-700 dark:text-slate-300"
                >部材としてカウント</span
              >
            </label>
          </div>
          <div
            id="edit-shop-spl-group"
            class="hidden pt-2 flex items-center space-x-4"
          >
            <label class="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                id="edit-has-shop-spl"
                class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
              />
              <span
                class="text-sm font-medium text-slate-700 dark:text-slate-300"
                >工場でSPLセットあり</span
              >
            </label>
            <div id="edit-bolt-correction-group">
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  id="edit-has-bolt-correction"
                  class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
                />
                <span
                  class="text-sm font-medium text-slate-700 dark:text-slate-300"
                  >増しボルト補正あり</span
                >
              </label>
            </div>
          </div>
          <div id="edit-bundle-column-group" class="flex items-center mt-2">
            <input
              type="checkbox"
              id="edit-is-bundled-with-column"
              class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
            />
            <label
              for="edit-is-bundled-with-column"
              class="ml-2 block text-sm text-gray-900 dark:text-gray-300"
            >
              本柱と同梱
              <span class="text-xs text-gray-500"
                >※本ボルト明細で「本柱」に合算</span
              >
            </label>
          </div>
        </div>

        <div>
          <label
            for="edit-joint-name"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >継手名</label
          >
          <input
            type="text"
            id="edit-joint-name"
            class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
          />
        </div>
        <div>
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >表示色 (任意)</label
          >
          <div
            class="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg border border-gray-200 dark:border-slate-700"
          >
            <div
              id="color-palette-container"
              class="flex flex-wrap gap-2 mb-3"
            ></div>

            <div
              class="flex items-center justify-between pt-2 border-t border-gray-200 dark:border-slate-600"
            >
              <label
                class="flex items-center gap-2 cursor-pointer text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400"
              >
                <div class="relative">
                  <span
                    class="block w-8 h-8 rounded-full bg-gradient-to-br from-red-500 via-green-500 to-blue-500 border border-slate-300 shadow-sm"
                  ></span>
                  <input
                    type="color"
                    id="edit-joint-color"
                    class="absolute inset-0 opacity-0 cursor-pointer w-full h-full"
                  />
                </div>
                <span>その他の色...</span>
              </label>

              <button
                type="button"
                id="clear-joint-color-btn"
                class="text-xs text-slate-500 hover:text-red-500 dark:text-slate-400 dark:hover:text-red-400 border border-slate-300 dark:border-slate-600 px-2 py-1 rounded hover:bg-white dark:hover:bg-slate-700 transition-colors"
              >
                設定なし
              </button>
            </div>
          </div>
        </div>
        <div id="edit-flange-group">
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            id="edit-flange-label"
            >フランジ</label
          >
          <div class="grid grid-cols-2 gap-4">
            <div class="relative">
              <input
                type="text"
                id="edit-flange-size"
                readonly
                class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 pr-10 cursor-pointer modal-trigger-input"
                placeholder="サイズ選択"
              />
              <button
                data-target="edit-flange-size"
                class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:text-blue-800 dark:hover:text-blue-400"
              >
                ▼
              </button>
            </div>
            <input
              type="number"
              id="edit-flange-count"
              min="0"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
              placeholder="本数"
            />
          </div>
        </div>

        <div id="edit-web-group">
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >ウェブ</label
          >
          <div class="grid grid-cols-2 gap-4">
            <div class="relative">
              <input
                type="text"
                id="edit-web-size"
                readonly
                class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 pr-10 cursor-pointer modal-trigger-input"
                placeholder="サイズ選択"
              />
              <button
                data-target="edit-web-size"
                class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:text-blue-800 dark:hover:text-blue-400"
              >
                ▼
              </button>
            </div>
            <input
              type="number"
              id="edit-web-count"
              min="0"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
              placeholder="本数"
            />
          </div>
        </div>
        <div id="edit-web-input-group-2" class="hidden">
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >ウェブ 2</label
          >
          <div class="grid grid-cols-2 gap-4">
            <div class="relative">
              <input
                type="text"
                id="edit-web-size-2"
                readonly
                class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 pr-10 cursor-pointer modal-trigger-input"
                placeholder="サイズ選択"
              />
              <button
                data-target="edit-web-size-2"
                class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:text-blue-800 dark:hover:text-blue-400"
              >
                ▼
              </button>
            </div>
            <input
              type="number"
              id="edit-web-count-2"
              min="0"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
              placeholder="本数"
            />
          </div>
        </div>
        <div id="edit-web-input-group-3" class="hidden">
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >ウェブ 3</label
          >
          <div class="grid grid-cols-2 gap-4">
            <div class="relative">
              <input
                type="text"
                id="edit-web-size-3"
                readonly
                class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 pr-10 cursor-pointer modal-trigger-input"
                placeholder="サイズ選択"
              />
              <button
                data-target="edit-web-size-3"
                class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:text-blue-800 dark:hover:text-blue-400"
              >
                ▼
              </button>
            </div>
            <input
              type="number"
              id="edit-web-count-3"
              min="0"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
              placeholder="本数"
            />
          </div>
        </div>
        <div id="edit-web-input-group-4" class="hidden">
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >ウェブ 4</label
          >
          <div class="grid grid-cols-2 gap-4">
            <div class="relative">
              <input
                type="text"
                id="edit-web-size-4"
                readonly
                class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 pr-10 cursor-pointer modal-trigger-input"
                placeholder="サイズ選択"
              />
              <button
                data-target="edit-web-size-4"
                class="bolt-select-trigger absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:text-blue-800 dark:hover:text-blue-400"
              >
                ▼
              </button>
            </div>
            <input
              type="number"
              id="edit-web-count-4"
              min="0"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
              placeholder="本数"
            />
          </div>
        </div>
      </div>

      <div
        class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4 border-t border-gray-200 dark:border-slate-700"
      >
        <button id="cancel-edit-btn" class="btn btn-neutral">キャンセル</button>
        <button id="save-joint-btn" class="btn btn-primary">保存</button>
      </div>
    </div>
    <div
      id="edit-member-modal"
      class="modal modeless fixed top-32 left-1/2 transform -translate-x-1/2 bg-white dark:bg-slate-800 rounded-xl shadow-2xl shadow-black/50 w-full max-w-md border border-slate-200 dark:border-slate-600 z-50 hidden opacity-0"
    >
      <div
        class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700 cursor-move select-none"
      >
        <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">
          部材の編集
        </h3>
        <button
          id="close-edit-member-modal-btn"
          class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
        >
          &times;
        </button>
      </div>

      <div class="p-6 space-y-4">
        <input type="hidden" id="edit-member-id" />
        <div>
          <label
            for="edit-member-name"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >部材名</label
          >
          <input
            type="text"
            id="edit-member-name"
            class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
          />
        </div>
        <div>
          <label
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >使用する階層 (選択なし＝全階層)</label
          >
          <div
            id="edit-member-levels-container"
            class="grid grid-cols-3 gap-2 max-h-32 overflow-y-auto custom-scrollbar border border-gray-300 dark:border-slate-600 rounded-md p-2 bg-gray-50 dark:bg-slate-800"
          ></div>
        </div>
        <div>
          <label
            for="edit-member-joint-select"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
            >使用する継手</label
          >
          <select
            id="edit-member-joint-select"
            class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
          ></select>
        </div>
      </div>

      <div
        class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4 border-t border-gray-200 dark:border-slate-700"
      >
        <button id="cancel-member-edit-btn" class="btn btn-neutral">
          キャンセル
        </button>
        <button id="save-member-btn" class="btn btn-primary">保存</button>
      </div>
    </div>
    <div
      id="confirm-delete-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-sm"
      >
        <div class="p-6 text-center">
          <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100 mb-2">
            確認
          </h3>
          <p
            id="confirm-delete-message"
            class="text-gray-600 dark:text-gray-300 mb-6"
          ></p>
          <input type="hidden" id="delete-id" />
          <input type="hidden" id="delete-type" />
          <div class="flex justify-center gap-4">
            <button id="cancel-delete-btn" class="btn btn-neutral">
              いいえ
            </button>
            <button id="confirm-delete-btn" class="btn btn-danger">はい</button>
          </div>
        </div>
      </div>
    </div>
    <div
      id="confirm-add-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-40"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-sm"
      >
        <div class="p-6 text-center">
          <h3 class="text-xl font-bold text-yellow-600 mb-2">警告</h3>
          <p
            id="confirm-add-message"
            class="text-gray-600 dark:text-gray-300 mb-6"
          ></p>
          <div class="flex justify-center gap-4">
            <button id="cancel-add-btn" class="btn btn-neutral">
              キャンセル
            </button>
            <button id="confirm-add-btn" class="btn btn-primary">
              このまま登録
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      id="edit-project-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-md"
      >
        <div
          class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700"
        >
          <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">
            工事情報の編集
          </h3>
          <button
            id="close-edit-project-modal-btn"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
          >
            &times;
          </button>
        </div>
        <div class="p-6 space-y-4">
          <input type="hidden" id="edit-project-id" />
          <div>
            <label
              for="edit-project-name"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
              >工事名</label
            >
            <input
              type="text"
              id="edit-project-name"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
            />
          </div>
          <div>
            <label
              for="edit-property-name"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
              >物件名（グループ化用）</label
            >
            <input
              type="text"
              id="edit-property-name"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
              placeholder="（例）ABCビル"
            />
            <p class="text-xs text-slate-500 mt-1">
              同じ物件名を入力した工事が自動でグループ化されます。
            </p>
          </div>

          <div
            id="edit-advanced-toggle-wrapper"
            class="hidden items-center gap-2 pt-2"
          >
            <input
              type="checkbox"
              id="edit-advanced-settings-toggle"
              class="h-4 w-4 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
            />
            <label
              for="edit-advanced-settings-toggle"
              class="text-sm font-medium text-slate-700 dark:text-slate-300"
              >細かい設定</label
            >
          </div>
          <div id="edit-simple-project-settings">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label
                  for="edit-project-floors"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >階数</label
                >
                <input
                  type="number"
                  id="edit-project-floors"
                  min="2"
                  class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
                />
              </div>
              <div>
                <label
                  for="edit-project-sections"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >工区数</label
                >
                <input
                  type="number"
                  id="edit-project-sections"
                  min="1"
                  class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
                />
              </div>
            </div>
            <div
              class="flex items-center gap-4 bg-slate-100 dark:bg-slate-700/50 p-3 rounded-md mt-4"
            >
              <label
                for="edit-project-has-ph"
                class="font-medium text-slate-700 dark:text-slate-300"
                >PH階 (塔屋) はありますか？</label
              >
              <input
                type="checkbox"
                id="edit-project-has-ph"
                class="h-5 w-5 rounded border-gray-300 text-blue-800 focus:ring-yellow-500"
              />
            </div>
          </div>
          <div id="edit-advanced-project-settings" class="hidden space-y-4">
            <div>
              <label
                for="edit-custom-levels-count"
                class="block text-sm font-medium text-blue-800 dark:text-blue-400 mb-1"
                >階層数</label
              >
              <div
                class="flex items-center border border-gray-400 dark:border-slate-600 rounded-md"
              >
                <button
                  type="button"
                  id="decrement-levels-btn"
                  class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-l-md transition-colors font-bold text-lg"
                >
                  -
                </button>
                <input
                  type="text"
                  id="edit-custom-levels-count"
                  readonly
                  class="w-full text-center border-l border-r dark:border-slate-600 bg-white dark:bg-slate-700 p-3 text-gray-900 dark:text-slate-100 focus:outline-none"
                />
                <button
                  type="button"
                  id="increment-levels-btn"
                  class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-r-md transition-colors font-bold text-lg"
                >
                  +
                </button>
              </div>
              <div
                id="edit-custom-levels-container"
                class="grid grid-cols-2 sm:grid-cols-3 gap-2 mt-2"
              ></div>
            </div>
            <div>
              <label
                for="edit-custom-areas-count"
                class="block text-sm font-medium text-blue-800 dark:text-blue-400 mb-1"
                >エリア数</label
              >
              <div
                class="flex items-center border border-gray-400 dark:border-slate-600 rounded-md"
              >
                <button
                  type="button"
                  id="decrement-areas-btn"
                  class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-l-md transition-colors font-bold text-lg"
                >
                  -
                </button>
                <input
                  type="text"
                  id="edit-custom-areas-count"
                  readonly
                  class="w-full text-center border-l border-r dark:border-slate-600 bg-white dark:bg-slate-700 p-3 text-gray-900 dark:text-slate-100 focus:outline-none"
                />
                <button
                  type="button"
                  id="increment-areas-btn"
                  class="px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-r-md transition-colors font-bold text-lg"
                >
                  +
                </button>
              </div>
              <div
                id="edit-custom-areas-container"
                class="grid grid-cols-2 sm:grid-cols-3 gap-2 mt-2"
              ></div>
            </div>
          </div>
        </div>
        <div
          class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4"
        >
          <button id="cancel-project-edit-btn" class="btn btn-neutral">
            キャンセル
          </button>
          <button id="save-project-btn" class="btn btn-primary">保存</button>
        </div>
      </div>
    </div>
    <div
      id="edit-group-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-md"
      >
        <div
          class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700"
        >
          <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">
            物件名の編集
          </h3>
          <button
            id="close-edit-group-modal-btn"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
          >
            &times;
          </button>
        </div>
        <div class="p-6 space-y-4">
          <input type="hidden" id="edit-group-old-name" />
          <div>
            <label
              for="edit-group-new-name"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
              >新しい物件名</label
            >
            <input
              type="text"
              id="edit-group-new-name"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
            />
            <p class="text-xs text-slate-500 mt-1">
              この物件名に紐づく全ての工事に適用されます。
            </p>
          </div>
        </div>
        <div
          class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4"
        >
          <button id="cancel-edit-group-btn" class="btn btn-neutral">
            キャンセル
          </button>
          <button id="save-group-btn" class="btn btn-primary">保存</button>
        </div>
      </div>
    </div>
    <div
      id="aggregated-results-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col"
      >
        <div
          class="flex justify-between items-center p-5 border-b-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 rounded-t-lg"
        >
          <h3
            id="aggregated-results-title"
            class="text-xl font-bold text-slate-900 dark:text-slate-100"
          ></h3>
          <button
            id="close-aggregated-results-modal-btn"
            class="text-gray-400 hover:text-red-500 text-2xl"
          >
            &times;
          </button>
        </div>
        <div
          id="aggregated-results-content"
          class="p-6 space-y-8 overflow-y-auto custom-scrollbar"
        ></div>
      </div>
    </div>
    <div
      id="bolt-selector-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-[60]"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col"
      >
        <div
          class="flex justify-between items-center p-5 border-b-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 rounded-t-lg"
        >
          <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">
            ボルトサイズを選択
          </h3>
          <button
            id="close-bolt-modal-btn"
            class="text-gray-400 hover:text-red-500 text-2xl"
          >
            &times;
          </button>
        </div>
        <div
          id="bolt-options-container"
          class="p-6 space-y-4 overflow-y-auto custom-scrollbar"
        ></div>
      </div>
    </div>
    <div
      id="bolt-size-settings-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-[60]"
    >
      <div
        class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-lg border border-slate-200 dark:border-slate-600 flex flex-col max-h-[85vh]"
      >
        <div
          class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700"
        >
          <h3 class="text-xl font-bold text-slate-800 dark:text-slate-100">
            ボルトサイズ管理
          </h3>
          <button
            id="close-bolt-size-modal-btn"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
          >
            &times;
          </button>
        </div>

        <div class="p-6 overflow-y-auto custom-scrollbar flex-1">
          <div
            class="bg-blue-50 dark:bg-slate-700/50 p-4 rounded-lg mb-6 border border-blue-100 dark:border-slate-600"
          >
            <h4
              class="text-sm font-bold text-slate-700 dark:text-slate-300 mb-2"
            >
              新規サイズの追加
            </h4>
            <div class="flex flex-col gap-3">
              <div class="flex gap-2">
                <div class="w-2/3">
                  <label
                    class="block text-xs text-slate-500 dark:text-slate-400 mb-1"
                    >種類 (Type)</label
                  >
                  <select
                    id="new-bolt-type-select"
                    class="w-full bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded px-2 py-2 text-sm text-slate-800 dark:text-slate-200"
                  ></select>
                </div>
                <div class="w-1/3">
                  <label
                    class="block text-xs text-slate-500 dark:text-slate-400 mb-1"
                    >長さ (mm)</label
                  >
                  <input
                    type="number"
                    id="new-bolt-length-input"
                    class="w-full bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded px-2 py-2 text-sm text-slate-800 dark:text-slate-200"
                    placeholder="例: 45"
                  />
                </div>
              </div>
              <button
                id="add-bolt-size-btn"
                class="btn btn-primary w-full flex justify-center items-center gap-2"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 4v16m8-8H4"
                  />
                </svg>
                リストに追加
              </button>
            </div>
          </div>
          <div
            class="flex border-b border-gray-200 dark:border-slate-700 mb-4 overflow-x-auto custom-scrollbar"
          >
            <button
              type="button"
              class="bolt-tab-btn px-4 py-2 text-sm font-medium whitespace-nowrap text-blue-600 border-b-2 border-blue-600 dark:text-blue-400 dark:border-blue-400"
              data-tab="all"
            >
              すべて
            </button>
            <button
              type="button"
              class="bolt-tab-btn px-4 py-2 text-sm font-medium whitespace-nowrap text-slate-500 border-b-2 border-transparent hover:text-slate-700 hover:border-slate-300 dark:text-slate-400 dark:hover:text-slate-200"
              data-tab="M16"
            >
              M16
            </button>
            <button
              type="button"
              class="bolt-tab-btn px-4 py-2 text-sm font-medium whitespace-nowrap text-slate-500 border-b-2 border-transparent hover:text-slate-700 hover:border-slate-300 dark:text-slate-400 dark:hover:text-slate-200"
              data-tab="M20"
            >
              M20
            </button>
            <button
              type="button"
              class="bolt-tab-btn px-4 py-2 text-sm font-medium whitespace-nowrap text-slate-500 border-b-2 border-transparent hover:text-slate-700 hover:border-slate-300 dark:text-slate-400 dark:hover:text-slate-200"
              data-tab="M22"
            >
              M22
            </button>
            <button
              type="button"
              class="bolt-tab-btn px-4 py-2 text-sm font-medium whitespace-nowrap text-slate-500 border-b-2 border-transparent hover:text-slate-700 hover:border-slate-300 dark:text-slate-400 dark:hover:text-slate-200"
              data-tab="chubo"
            >
              中ボルト
            </button>
            <button
              type="button"
              class="bolt-tab-btn px-4 py-2 text-sm font-medium whitespace-nowrap text-slate-500 border-b-2 border-transparent hover:text-slate-700 hover:border-slate-300 dark:text-slate-400 dark:hover:text-slate-200"
              data-tab="dlock_dobu"
            >
              D-Lock(ドブ)
            </button>
            <button
              type="button"
              class="bolt-tab-btn px-4 py-2 text-sm font-medium whitespace-nowrap text-slate-500 border-b-2 border-transparent hover:text-slate-700 hover:border-slate-300 dark:text-slate-400 dark:hover:text-slate-200"
              data-tab="dlock_uni"
            >
              D-Lock(ユニ)
            </button>
            <button
              type="button"
              class="bolt-tab-btn px-4 py-2 text-sm font-medium whitespace-nowrap text-slate-500 border-b-2 border-transparent hover:text-slate-700 hover:border-slate-300 dark:text-slate-400 dark:hover:text-slate-200"
              data-tab="other"
            >
              その他
            </button>
          </div>
          <h4
            class="text-sm font-bold text-slate-700 dark:text-slate-300 mb-2 flex justify-between items-center"
          >
            登録済みサイズ一覧
            <span
              id="bolt-size-count"
              class="text-xs font-normal text-slate-500"
            ></span>
          </h4>
          <ul id="bolt-size-list" class="space-y-2 pb-4"></ul>
        </div>

        <div
          class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4 border-t border-gray-200 dark:border-slate-700"
        >
          <button id="save-bolt-size-settings-btn" class="btn btn-primary">
            閉じる (保存)
          </button>
        </div>
      </div>
    </div>
    <div
      id="custom-alert-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-[70]"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-sm"
      >
        <div class="p-6 text-center">
          <h3 id="custom-alert-title" class="text-xl font-bold mb-4"></h3>
          <p
            id="custom-alert-message"
            class="text-gray-600 dark:text-gray-300 mb-6"
          ></p>
          <button id="close-alert-btn" class="btn btn-primary">閉じる</button>
        </div>
      </div>
    </div>
    <div
      id="joint-selector-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col"
      >
        <div
          class="flex justify-between items-center p-5 border-b-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 rounded-t-lg"
        >
          <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">
            継手を選択
          </h3>
          <button
            id="close-joint-modal-btn"
            class="text-gray-400 hover:text-red-500 text-2xl"
          >
            &times;
          </button>
        </div>
        <div
          id="joint-options-container"
          class="p-6 space-y-4 overflow-y-auto custom-scrollbar"
        ></div>
      </div>
    </div>
    <div
      id="temp-bolt-mapping-modal"
      class="modal modeless fixed top-28 left-1/2 transform -translate-x-1/2 bg-white dark:bg-slate-800 rounded-xl shadow-2xl shadow-black/50 w-full max-w-4xl max-h-[80vh] flex flex-col border border-slate-200 dark:border-slate-600 z-50 hidden opacity-0"
    >
      <div
        class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700 cursor-move select-none"
      >
        <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">
          仮ボルト対応設定
        </h3>
        <button
          id="close-temp-bolt-mapping-modal-btn"
          class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
        >
          &times;
        </button>
      </div>

      <div
        id="temp-bolt-mapping-container"
        class="p-6 space-y-4 overflow-y-auto custom-scrollbar flex-1"
      ></div>

      <div
        class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4 border-t border-gray-200 dark:border-slate-700"
      >
        <button id="cancel-temp-bolt-mapping-btn" class="btn btn-neutral">
          キャンセル
        </button>
        <button id="save-temp-bolt-mapping-btn" class="btn btn-primary">
          保存
        </button>
      </div>
    </div>
    <div
      id="confirm-member-deletion-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-50"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-md"
      >
        <div class="p-6 text-center">
          <h3 class="text-xl font-bold text-yellow-600 mb-4">警告</h3>
          <p
            id="confirm-member-deletion-message"
            class="text-gray-600 dark:text-gray-300 mb-6 text-left"
          ></p>
          <div class="flex justify-center gap-4">
            <button id="cancel-member-deletion-btn" class="btn btn-neutral">
              キャンセル
            </button>
            <button id="confirm-member-deletion-btn" class="btn btn-danger">
              削除して続行
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      id="confirm-action-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-50"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-md"
      >
        <div class="p-6 text-center">
          <h3
            id="confirm-action-title"
            class="text-xl font-bold text-yellow-600 mb-4"
          >
            確認
          </h3>
          <p
            id="confirm-action-message"
            class="text-gray-600 dark:text-gray-300 mb-6 text-left"
          ></p>
          <div class="flex justify-center gap-4">
            <button id="cancel-action-btn" class="btn btn-neutral">
              キャンセル
            </button>
            <button id="confirm-action-btn" class="btn btn-danger">
              実行する
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      id="bulk-add-member-modal"
      class="modal modeless fixed top-24 left-1/2 transform -translate-x-1/2 bg-white dark:bg-slate-800 rounded-xl shadow-2xl shadow-black/50 w-full max-w-lg flex flex-col max-h-[85vh] border border-slate-200 dark:border-slate-600 z-50 hidden opacity-0"
    >
      <div
        class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700 cursor-move select-none"
      >
        <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">
          部材の一括登録 (最大15件)
        </h3>
        <button
          id="close-bulk-add-member-modal-btn"
          class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
        >
          &times;
        </button>
      </div>

      <div class="p-6 space-y-6 overflow-y-auto custom-scrollbar flex-1">
        <div
          class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg border border-slate-200 dark:border-slate-600 space-y-4"
        >
          <h4
            class="font-bold text-slate-700 dark:text-slate-200 border-b border-slate-300 dark:border-slate-500 pb-1 mb-2"
          >
            共通設定
          </h4>
          <div>
            <label
              for="bulk-member-joint-select"
              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
              >使用する継手 (共通)</label
            >
            <select
              id="bulk-member-joint-select"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
            ></select>
          </div>
          <!-- <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">使用する階層 (共通)</label>
                    <div id="bulk-member-levels-container"
                        class="grid grid-cols-3 gap-2 max-h-24 overflow-y-auto custom-scrollbar border border-gray-300 dark:border-slate-600 rounded-md p-2 bg-white dark:bg-slate-800">
                    </div>
                </div> -->
        </div>

        <div>
          <div class="flex justify-between items-end mb-2">
            <label
              class="block text-sm font-medium text-slate-700 dark:text-slate-300"
              >部材名リスト</label
            >
            <button
              id="add-bulk-input-btn"
              class="text-xs bg-blue-100 text-blue-700 hover:bg-blue-200 px-2 py-1 rounded border border-blue-300 transition-colors"
            >
              ＋ 入力欄を追加
            </button>
          </div>
          <div id="bulk-member-inputs-container" class="space-y-3"></div>
          <div
            id="bulk-level-selector-modal"
            class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-[80]"
          >
            <div
              class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-sm"
            >
              <div
                class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700"
              >
                <h3
                  id="bulk-level-selector-title"
                  class="text-xl font-bold text-slate-900 dark:text-slate-100"
                >
                  階層を選択
                </h3>
                <button
                  id="close-bulk-level-modal-btn"
                  class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
                >
                  &times;
                </button>
              </div>
              <div
                id="bulk-level-options-container"
                class="p-6 space-y-4 overflow-y-auto custom-scrollbar max-h-72"
              ></div>
              <div
                class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4 border-t border-gray-200 dark:border-slate-700"
              >
                <button id="save-bulk-level-btn" class="btn btn-primary">
                  決定
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4 border-t border-gray-200 dark:border-slate-700"
      >
        <button id="cancel-bulk-add-member-btn" class="btn btn-neutral">
          キャンセル
        </button>
        <button id="save-bulk-member-btn" class="btn btn-primary">
          一括登録を実行
        </button>
      </div>
    </div>
    <div
      id="bulk-level-selector-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-[80]"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-sm"
      >
        <div
          class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700"
        >
          <h3
            id="bulk-level-selector-title"
            class="text-xl font-bold text-slate-900 dark:text-slate-100"
          >
            階層を選択
          </h3>
          <button
            id="close-bulk-level-modal-btn"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
          >
            &times;
          </button>
        </div>
        <div
          id="bulk-level-options-container"
          class="p-6 space-y-4 overflow-y-auto custom-scrollbar max-h-72"
        ></div>
        <div
          class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4 border-t border-gray-200 dark:border-slate-700"
        >
          <button id="save-bulk-level-btn" class="btn btn-primary">決定</button>
        </div>
      </div>
    </div>
    <div class="hidden">
      <span
        class="grid grid-cols-1 grid-cols-2 grid-cols-3 sm:grid-cols-2 sm:grid-cols-3 sm:grid-cols-4 md:grid-cols-5"
      ></span>
      <span
        class="p-2 hover:bg-yellow-200 dark:hover:bg-yellow-600 rounded-md transition pb-1"
      ></span>
      <span
        class="bg-blue-50 bg-blue-100 bg-blue-200 bg-blue-300 text-blue-700 text-blue-800 text-blue-900 border-blue-200 border-blue-300 border-blue-400 hover:bg-blue-100"
      ></span>
      <span
        class="dark:bg-blue-900/50 dark:border-blue-700 dark:text-blue-200 dark:bg-blue-800/60 dark:hover:bg-blue-700/60"
      ></span>
      <span
        class="bg-green-50 bg-green-100 bg-green-200 bg-green-300 text-green-700 text-green-800 text-green-900 border-green-200 border-green-300 border-green-400 hover:bg-green-100"
      ></span>
      <span
        class="dark:bg-green-900/50 dark:border-green-700 dark:text-green-200 dark:bg-green-800/60 dark:hover:bg-green-700/60"
      ></span>
      <span
        class="bg-purple-50 bg-purple-100 bg-purple-200 bg-purple-300 text-purple-700 text-purple-800 text-purple-900 border-purple-200 border-purple-300 border-purple-400 hover:bg-purple-100"
      ></span>
      <span
        class="dark:bg-purple-900/50 dark:border-purple-700 dark:text-purple-200 dark:bg-purple-800/60 dark:hover:bg-purple-700/60"
      ></span>
      <span
        class="bg-gray-50 bg-gray-100 bg-gray-200 bg-gray-300 text-gray-700 text-gray-800 text-gray-900 border-gray-200 border-gray-300 border-gray-400 hover:bg-gray-100"
      ></span>
      <span
        class="dark:bg-gray-900/50 dark:border-gray-700 dark:text-gray-200 dark:bg-gray-800/60 dark:hover:bg-gray-700/60"
      ></span>
      <span
        class="bg-indigo-50 bg-indigo-100 bg-indigo-200 bg-indigo-300 text-indigo-700 text-indigo-800 text-indigo-900 border-indigo-200 border-indigo-300 border-indigo-400 hover:bg-indigo-100"
      ></span>
      <span
        class="dark:bg-indigo-900/50 dark:border-indigo-700 dark:text-indigo-200 dark:bg-indigo-800/60 dark:hover:bg-indigo-700/60"
      ></span>
      <span
        class="bg-teal-50 bg-teal-100 bg-teal-200 bg-teal-300 text-teal-700 text-teal-800 text-teal-900 border-teal-200 border-teal-300 border-teal-400 hover:bg-teal-100"
      ></span>
      <span
        class="dark:bg-teal-900/50 dark:border-teal-700 dark:text-teal-200 dark:bg-teal-800/60 dark:hover:bg-teal-700/60"
      ></span>
      <span
        class="bg-cyan-50 bg-cyan-100 bg-cyan-200 bg-cyan-300 text-cyan-700 text-cyan-800 text-cyan-900 border-cyan-200 border-cyan-300 border-cyan-400 hover:bg-cyan-100"
      ></span>
      <span
        class="dark:bg-cyan-900/50 dark:border-cyan-700 dark:text-cyan-200 dark:bg-cyan-800/60 dark:hover:bg-cyan-700/60"
      ></span>
      <span
        class="bg-pink-50 bg-pink-100 bg-pink-200 bg-pink-300 text-pink-700 text-pink-800 text-pink-900 border-pink-200 border-pink-300 border-pink-400 hover:bg-pink-100"
      ></span>
      <span
        class="dark:bg-pink-900/50 dark:border-pink-700 dark:text-pink-200 dark:bg-pink-800/60 dark:hover:bg-pink-700/60"
      ></span>
      <span
        class="bg-yellow-50 bg-yellow-100 bg-yellow-200 bg-yellow-300 text-yellow-700 text-yellow-800 text-yellow-900 border-yellow-200 border-yellow-300 border-yellow-400 hover:bg-yellow-100"
      ></span>
      <span
        class="dark:bg-yellow-900/50 dark:border-yellow-700 dark:text-yellow-200 dark:bg-yellow-800/60 dark:hover:bg-yellow-700/60"
      ></span>
      <span
        class="bg-orange-50 bg-orange-100 bg-orange-200 bg-orange-300 text-orange-700 text-orange-800 text-orange-900 border-orange-200 border-orange-300 border-orange-400 hover:bg-orange-100"
      ></span>
      <span
        class="dark:bg-orange-900/50 dark:border-orange-700 dark:text-orange-200 dark:bg-orange-800/60 dark:hover:bg-orange-700/60"
      ></span>
      <span
        class="bg-amber-50 bg-amber-100 bg-amber-200 bg-amber-300 text-amber-700 text-amber-800 text-amber-900 border-amber-200 border-amber-300 border-amber-400 hover:bg-amber-100"
      ></span>
      <span
        class="dark:bg-amber-900/50 dark:border-amber-700 dark:text-amber-200 dark:bg-amber-800/60 dark:hover:bg-amber-700/60"
      ></span>
      <span
        class="bg-red-50 bg-red-100 bg-red-200 bg-red-300 text-red-700 text-red-800 text-red-900 border-red-200 border-red-300 border-red-400 hover:bg-red-100"
      ></span>
      <span
        class="dark:bg-red-900/50 dark:border-red-700 dark:text-red-200 dark:bg-red-800/60 dark:hover:bg-red-700/60"
      ></span>
    </div>

    <script type="module" src="js/app.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const btnJoints = document.getElementById("switch-view-joints");
        const btnMembers = document.getElementById("switch-view-members");
        const areaJoints = document.getElementById("view-joints-area");
        const areaMembers = document.getElementById("view-members-area");

        // アクティブなボタンのクラス
        const activeClass = [
          "bg-white",
          "dark:bg-slate-600",
          "text-blue-800",
          "dark:text-blue-100",
          "shadow-sm",
        ];
        // 非アクティブなボタンのクラス
        const inactiveClass = [
          "text-slate-600",
          "dark:text-slate-400",
          "hover:bg-slate-300",
          "dark:hover:bg-slate-600",
        ];

        function switchTab(target) {
          if (target === "joints") {
            // 表示エリアの切替
            areaJoints.classList.remove("hidden");
            areaMembers.classList.add("hidden");

            // ボタンのスタイル更新
            btnJoints.classList.add(...activeClass);
            btnJoints.classList.remove(...inactiveClass);

            btnMembers.classList.remove(...activeClass);
            btnMembers.classList.add(...inactiveClass);
          } else {
            // 表示エリアの切替
            areaJoints.classList.add("hidden");
            areaMembers.classList.remove("hidden");

            // ボタンのスタイル更新
            btnMembers.classList.add(...activeClass);
            btnMembers.classList.remove(...inactiveClass);

            btnJoints.classList.remove(...activeClass);
            btnJoints.classList.add(...inactiveClass);
          }
        }

        // イベントリスナー
        btnJoints.addEventListener("click", () => switchTab("joints"));
        btnMembers.addEventListener("click", () => switchTab("members"));
      });
    </script>
    <div
      id="details-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-50"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-sm flex flex-col max-h-[85vh]"
      >
        <div
          class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700"
        >
          <h3
            id="details-modal-title"
            class="text-xl font-bold text-slate-900 dark:text-slate-100"
          >
            内訳詳細
          </h3>
          <button
            id="close-details-modal-btn"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
          >
            &times;
          </button>
        </div>
        <div
          id="details-modal-content"
          class="p-6 overflow-y-auto custom-scrollbar"
        ></div>
      </div>
    </div>
    <div
      id="toast-container"
      class="fixed top-20 right-5 z-50 w-full max-w-xs space-y-2"
    ></div>
    <div
      id="fab-container"
      class="fixed bottom-24 right-6 z-40 flex flex-col items-end gap-3 hidden pointer-events-none"
    >
      <button
        id="fab-temp-bolt"
        class="flex items-center gap-2 bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-full shadow-lg transform transition-all duration-200 translate-y-10 opacity-0 pointer-events-none fab-sub-button"
      >
        <span class="text-sm font-bold">仮ボルト</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"
          />
          <path
            fill-rule="evenodd"
            d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
            clip-rule="evenodd"
          />
        </svg>
      </button>
      <button
        id="fab-bulk-add-member"
        class="flex items-center gap-2 bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-full shadow-lg transform transition-all duration-200 translate-y-10 opacity-0 pointer-events-none fab-sub-button"
      >
        <span class="text-sm font-bold">部材一括登録</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
          ></path>
          <path
            d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
          ></path>
        </svg>
      </button>
      <button
        id="fab-add-member"
        class="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-full shadow-lg transform transition-all duration-200 translate-y-10 opacity-0 pointer-events-none fab-sub-button"
      >
        <span class="text-sm font-bold">部材登録</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>

      <button
        id="fab-add-joint"
        class="flex items-center gap-2 bg-blue-800 hover:bg-blue-900 text-white px-4 py-2 rounded-full shadow-lg transform transition-all duration-200 translate-y-10 opacity-0 pointer-events-none fab-sub-button"
      >
        <span class="text-sm font-bold">継手登録</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
          ></path>
          <path
            d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
          ></path>
        </svg>
      </button>
      <button
        id="fab-search-trigger"
        class="bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-transform hover:scale-105 focus:outline-none z-50 pointer-events-auto border border-slate-200 dark:border-slate-600"
        title="検索を開く"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
      <button
        id="fab-toggle"
        class="bg-yellow-500 hover:bg-yellow-600 text-slate-900 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-300 z-50 pointer-events-auto"
      >
        <svg
          id="fab-icon-plus"
          xmlns="http://www.w3.org/2000/svg"
          class="w-8 h-8 transition-transform duration-300"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <line
            x1="12"
            y1="5"
            x2="12"
            y2="19"
            stroke-width="2"
            stroke-linecap="round"
          />
          <line
            x1="5"
            y1="12"
            x2="19"
            y2="12"
            stroke-width="2"
            stroke-linecap="round"
          />
        </svg>
      </button>
    </div>

    <div
      id="modeless-backdrop"
      class="fixed inset-0 z-40 hidden cursor-not-allowed"
    ></div>
    <div
      id="quick-nav-container"
      class="fixed bottom-6 right-6 z-40 flex flex-col items-end gap-2 hidden"
    >
      <div
        id="quick-nav-menu"
        class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-2xl p-2 mb-2 min-w-[200px] max-h-[60vh] overflow-y-auto custom-scrollbar transform transition-all duration-200 scale-95 opacity-0 origin-bottom-right pointer-events-none"
      >
        <div class="flex flex-col gap-1" id="quick-nav-links"></div>
      </div>

      <button
        id="quick-nav-toggle"
        class="bg-blue-600 hover:bg-blue-700 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-8 h-8"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
      </button>
    </div>
    <div
      id="copy-project-modal"
      class="modal fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-50"
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-md"
      >
        <div
          class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700"
        >
          <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">
            工事の複製
          </h3>
          <button
            id="close-copy-modal-btn"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl"
          >
            &times;
          </button>
        </div>
        <div class="p-6 space-y-6">
          <input type="hidden" id="copy-source-project-id" />
          <div>
            <label
              for="copy-new-project-name"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
              >新しい工事名</label
            >
            <input
              type="text"
              id="copy-new-project-name"
              class="w-full bg-white dark:bg-slate-700 border border-gray-400 dark:border-slate-600 text-gray-900 dark:text-slate-100 rounded-md p-3 focus:ring-yellow-500 focus:border-yellow-500"
            />
          </div>

          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
              >複製モード</label
            >
            <div class="space-y-3">
              <label
                class="flex items-center p-3 border border-gray-200 dark:border-slate-700 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
              >
                <input
                  type="radio"
                  name="copy-mode"
                  value="settings_only"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"
                />
                <div class="ml-3">
                  <span
                    class="block text-sm font-medium text-slate-900 dark:text-slate-100"
                    >設定のみコピー</span
                  >
                  <span class="block text-xs text-slate-500 dark:text-slate-400"
                    >階層・エリア設定のみ複製。継手・部材は空になります。</span
                  >
                </div>
              </label>
              <label
                class="flex items-center p-3 border border-gray-200 dark:border-slate-700 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
              >
                <input
                  type="radio"
                  name="copy-mode"
                  value="with_master"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"
                  checked
                />
                <div class="ml-3">
                  <span
                    class="block text-sm font-medium text-slate-900 dark:text-slate-100"
                    >マスタを含めてコピー</span
                  >
                  <span class="block text-xs text-slate-500 dark:text-slate-400"
                    >継手・部材も複製しますが、箇所数はリセットします。<br /><strong
                      class="text-yellow-600 dark:text-yellow-500"
                      >※追加発注に最適です</strong
                    ></span
                  >
                </div>
              </label>
              <label
                class="flex items-center p-3 border border-gray-200 dark:border-slate-700 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
              >
                <input
                  type="radio"
                  name="copy-mode"
                  value="full"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"
                />
                <div class="ml-3">
                  <span
                    class="block text-sm font-medium text-slate-900 dark:text-slate-100"
                    >丸ごとコピー</span
                  >
                  <span class="block text-xs text-slate-500 dark:text-slate-400"
                    >入力済みの箇所数も含めて完全に複製します。</span
                  >
                </div>
              </label>
            </div>
          </div>
        </div>
        <div
          class="px-6 py-4 bg-gray-50 dark:bg-slate-800 rounded-b-xl flex justify-end gap-4 border-t border-gray-200 dark:border-slate-700"
        >
          <button id="cancel-copy-btn" class="btn btn-neutral">
            キャンセル
          </button>
          <button id="execute-copy-btn" class="btn btn-primary">
            複製する
          </button>
        </div>
      </div>
    </div>
    <div id="search-widget">
      <div class="drag-handle" title="移動">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="9" cy="12" r="1"></circle>
          <circle cx="9" cy="5" r="1"></circle>
          <circle cx="9" cy="19" r="1"></circle>
          <circle cx="15" cy="12" r="1"></circle>
          <circle cx="15" cy="5" r="1"></circle>
          <circle cx="15" cy="19" r="1"></circle>
        </svg>
      </div>

      <div class="relative flex-1">
        <input
          type="text"
          id="search-input"
          class="w-full bg-slate-100 dark:bg-slate-700 border-none rounded text-sm py-1.5 pl-2 pr-16 focus:ring-1 focus:ring-blue-500 text-slate-800 dark:text-slate-100 placeholder-slate-400"
          placeholder="検索 (Ctrl+F)"
        />

        <div
          id="search-count"
          class="absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-slate-400 font-mono hidden"
        >
          <span id="search-current">0</span>/<span id="search-total">0</span>
        </div>
      </div>

      <button
        id="search-prev-btn"
        class="p-1.5 rounded hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 disabled:opacity-30"
        title="前へ (Shift+Enter)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M18 15l-6-6-6 6" />
        </svg>
      </button>
      <button
        id="search-next-btn"
        class="p-1.5 rounded hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 disabled:opacity-30"
        title="次へ (Enter)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M6 9l6 6 6-6" />
        </svg>
      </button>
      <button
        id="search-close-btn"
        class="p-1.5 rounded hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 ml-1"
        title="閉じる (Esc)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </body>
</html>
